<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Authorization</title>
</head>
<body>
  <script>
    (function() {
      function receiveMessage(e) {
        console.log("receiveMessage %o", e);
        window.opener.postMessage(
          'authorization:github:success:' + JSON.stringify({
            token: e.data.token,
            provider: 'github'
          }),
          e.origin
        );
        window.removeEventListener("message", receiveMessage, false);
      }
      
      window.addEventListener("message", receiveMessage, false);
      
      // Notify opener
      window.opener.postMessage("authorizing:github", "*");
      
      // Get token from URL hash
      const token = window.location.hash.match(/access_token=([^&]*)/);
      if (token) {
        window.opener.postMessage(
          'authorization:github:success:' + JSON.stringify({
            token: token[1],
            provider: 'github'
          }),
          '*'
        );
        setTimeout(function() {
          window.close();
        }, 100);
      }
    })();
  </script>
</body>
</html>
